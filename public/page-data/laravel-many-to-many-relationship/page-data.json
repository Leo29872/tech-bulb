{"componentChunkName":"component---src-templates-blog-post-js","path":"/laravel-many-to-many-relationship","webpackCompilationHash":"34a4d0741320adc0160d","result":{"data":{"markdownRemark":{"html":"<div class=\"blog-post__container\">\n<p>I’m a big fan of Eloquent and Laravel framework as well. Eloquent gives you a lot of opportunities to write really short and clean database queries.</p>\n<p>Today I want to present many-to-many database relation in Laravel. I don’t like fake examples when I read some articles, so I present you code from my side project <a href=\"http://wyjechani.pl/\" title=\"wyjechani.pl\" target=\"_blank\">wyjechani.pl</a> – which is application present travel offers where users votes for favourite offers.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 768px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 32.942708333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAB0ElEQVQoz02Ry2sTcRDH11P/Ej2JoMVLLuLVIvg4+apUKUKRevAgSK1Eq5gWEfGBPVSlYrCtiggWHwnVQzVWxGJtUtMkjaGVmmyyj+zub7Ovj5v1YAc+zMDAd+Y7I409fY/I5Fl8kePJ3Vn2xr/RdekHh68mufDwI5ZooTf1kCaWJTBME9O0QkwURUVVNZphT9N0fN9HujmawP6yxMKzJRLX55H2zCIdnGPX/hi95+P8llsUln+Szy9TKpUoFov8qlSiejGbZaVcxjAM6o0GQRAgzUwmKMzNQ83kytQ6UneWjr4yW08kODQ0ScOEulxFrtepyQpyQ0dR2wI6qmaGGNGGbVzXRXr9+Ab37yRIPZ/h+Pgam67pSCM+2wYfcW64D+F4kb22TatZRehreHbtH6IaZiUU8iKxyPLXt7eZGD7CqZM93EqtM/Qd+jMmpwdiDA50EvA/WrmzKKnNaB86Q3agprfg5PrZGFIyGWdnrIN9vQe4/OYTo5kF0oUSI/HddB/bHk1vT/Y8j8A18VsqvqNFBK6OKxRauo5jO7hOaPnVyzP0XDzK1LtpipUV/lRXMdQqn9PTTDy4h23bCCEiwptHG2/EFxZa+Ch5tU5TVvkL88XaHKvW/OQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"article1\" title=\"article1\" src=\"/static/9530aeb367d5d694d0b8b3451953c14c/5cc77/article1.png\" srcset=\"/static/9530aeb367d5d694d0b8b3451953c14c/02020/article1.png 243w,\n/static/9530aeb367d5d694d0b8b3451953c14c/d40d9/article1.png 485w,\n/static/9530aeb367d5d694d0b8b3451953c14c/5cc77/article1.png 768w\" sizes=\"(max-width: 768px) 100vw, 768px\" loading=\"lazy\">\n    </span>\n<p>User voting is many-to-many relation in that example. We have many user accounts on the website and single offer can have many votes from different users.</p>\n<p>We need an additional database table to store single votes. We have to link user id with offer id. There is no vote range – user votes for offers which means we increase count of votes.</p>\n<p>We need two models to represent User and Offer.</p>\n<p><span class=\"blog-post__file--name\"><i>app/Offer.php</i></span></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 970px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30.37109375%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAApklEQVQY052QiwrDIAxF+//fuuIzbTTRu6hlUBiFTTik1Xh6my3GDO89RARj9UHvf9FawxZCmsJMGcdBYGZwYWto+HUN6TYSOuexv5wRcXKBaoPK+KKhV33i6pnClAhEFSkoLBhqgclWFZNK7VM+nvV6F7lTi53pHNZKSDRS7kjZ5McJMaON42uaNeWHXw4hgqvNjfOUkVUuZSWs/UY1Wu+fy3fW3hvw1tj/9NTOmAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"article2\" title=\"article2\" src=\"/static/abde306f13a20203576a0183f9616bb3/9435c/article2.png\" srcset=\"/static/abde306f13a20203576a0183f9616bb3/02020/article2.png 243w,\n/static/abde306f13a20203576a0183f9616bb3/d40d9/article2.png 485w,\n/static/abde306f13a20203576a0183f9616bb3/9435c/article2.png 970w,\n/static/abde306f13a20203576a0183f9616bb3/3b243/article2.png 1024w\" sizes=\"(max-width: 970px) 100vw, 970px\" loading=\"lazy\">\n    </span>\n<p><span class=\"blog-post__file--name\"><i>app/User.php</i></span></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 970px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.21093749999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAAzklEQVQoz5WRC27EIAxEc/+zpiEYCB9jZm2iZtttlXaRRiBwXsbjhSjCOYfeO17XGOMtiQgW7wnruk4oEU3tfkdKaf7ECv+7rHbZFbhtmwI33T/gFRYjodSsKpAhn+W37i6g9wE5Z8RwoBRWV2bdHk+JJiFy3p3Q351dQMswanvOBYWyuurgNtDq+LZ3frr8CvkBNIfWWooNJQv0eH18l9VNy4SjHAjBa3YJKR9ozBNq7b9KxvhjKDspoII5o9aGbMNo9Wp1ip/nrmHeDecBed52vzT4SecAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"article3\" title=\"article3\" src=\"/static/6e9f4096ada960aec3295ea6990df87e/9435c/article3.png\" srcset=\"/static/6e9f4096ada960aec3295ea6990df87e/02020/article3.png 243w,\n/static/6e9f4096ada960aec3295ea6990df87e/d40d9/article3.png 485w,\n/static/6e9f4096ada960aec3295ea6990df87e/9435c/article3.png 970w,\n/static/6e9f4096ada960aec3295ea6990df87e/3b243/article3.png 1024w\" sizes=\"(max-width: 970px) 100vw, 970px\" loading=\"lazy\">\n    </span>\n<p>As you can see both of models belongsToMany themselves. Second parameter ‘offer_user’ is name of table which store that relation and we also declare ‘offer_id’ and ‘user_id’ which are names of columns in that table.</p>\n<p>Now we need to create that table. We run php artisan make:migration create_offer_user_table and added our parameters in that migration. Our migration file should look like:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 970px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 35.3515625%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAAuklEQVQoz5WQwQ7DIAxD+/8fOmmjjAKlQAJ4gWnVdqjWIlmBg19sJuc8lFLw3sM5N9TvxIzWGmptY55RrRXTsjjM8wxjDLTWA67UA2sIuHo6dPI+YIvbSNVnqe9ULAlLKaI6Nn8MR9qB1noxFFgbcFN33LWBeRLCFpBzFrHUL7vhKNkPkJiQUodsiBQhz0PTKWBMEc5brJKKqY2aOaexiEhqf1X+C1wWCyoMFhWpLkP+T4CUxz8yXwO+AP1gJ1vdItQtAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"article4\" title=\"article4\" src=\"/static/7c3eb8f8150398664eba0ea31505769f/9435c/article4.png\" srcset=\"/static/7c3eb8f8150398664eba0ea31505769f/02020/article4.png 243w,\n/static/7c3eb8f8150398664eba0ea31505769f/d40d9/article4.png 485w,\n/static/7c3eb8f8150398664eba0ea31505769f/9435c/article4.png 970w,\n/static/7c3eb8f8150398664eba0ea31505769f/3b243/article4.png 1024w\" sizes=\"(max-width: 970px) 100vw, 970px\" loading=\"lazy\">\n    </span>\n<p>Now we can run php artisan migrate which adds new table to our database.</p>\n<p>Now we can create VotesController with store method which get vote_id as parameter. In that method we check if the user is signed in. We find offer with vote_id and if it’s unique then we can use method declare in Offer model called users() and attach user id. It creates a record in our offer_user table. attach() is build in method to add relation, you can use detach() to remove specific relation as well.</p>\n<p>Ok, that’s all, but you can ask yourself: ok, that’s awesome, but show me some advantages of that relation. Why should I use that?</p>\n<p>The biggest advantage of that relation is our query to get offer data with votes and users which voted for specific offers. You can use a query like that:</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 970px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 6.15234375%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsSAAALEgHS3X78AAAANUlEQVQI14XKMQ7AIAwEwfz/q4kUEGDZyOdNlZpiurnmWJhtPJy7P7xtEV7sEJmiqpB09L8PX9dOosS++QkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"article5\" title=\"article5\" src=\"/static/572b5579833a302d61e1a47c9c02c7b6/9435c/article5.png\" srcset=\"/static/572b5579833a302d61e1a47c9c02c7b6/02020/article5.png 243w,\n/static/572b5579833a302d61e1a47c9c02c7b6/d40d9/article5.png 485w,\n/static/572b5579833a302d61e1a47c9c02c7b6/9435c/article5.png 970w,\n/static/572b5579833a302d61e1a47c9c02c7b6/3b243/article5.png 1024w\" sizes=\"(max-width: 970px) 100vw, 970px\" loading=\"lazy\">\n    </span>\n<p>Writing custom queries with raw SQL, a lot of join() methods can be really awful and can make your code dirty. Relations help you write understandable queries for other people. Eloquent is really great ORM and we should use that in an efficient way.</p>\n</div>","frontmatter":{"path":"/laravel-many-to-many-relationship","title":"Laravel many-to-many relationship","author":"Szymon Radosz","date":"2019-01-16"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}